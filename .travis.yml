language: php
php:
- 5.6
- 7.0
git:
  depth: 10
cache:
  directories:
  - $HOME/.composer
before_script:
  - composer require squizlabs/php_codesniffer:2.*
  - mkdir -p ~/build
  - git clone --branch hubzero-cms-2.1 --depth=1 https://github.com/hubzero/standards ~/build/standards
  - FILES=$((git log --pretty=format\:'' --name-only --since="yesterday"; git log --diff-filter=D --pretty=format\:'' --name-only --since="yesterday") | sort | uniq -u | tr '\r\n' ' ')
  - NEW=$(git diff--name-only $TRAVIS_PULL_REQUEST_BRANCH $(git merge-base $TRAVIS_PULL_REQUEST_BRANCH $TRAVIS_BRANCH)
  - echo $FILES
  - echo $NEW
  - echo $TRAVIS_BRANCH
  - echo $TRAVIS_PULL_REQUEST_BRANCH
  - echo $TRAVIS_EVENT_TYPE
script:
- vendor/squizlabs/php_codesniffer/scripts/phpcs -np --standard=~/build/standards/Php/ruleset.xml $FILES
