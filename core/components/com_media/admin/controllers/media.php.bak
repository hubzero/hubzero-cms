<?php

namespace Components\Media\Admin\Controllers;

use Hubzero\Component\AdminController;
use Components\Media\Models\Files;
use App;
use Filesystem;
use Request;
use User;

class Media extends AdminController
{
	public function execute()
	{
		$this->registerTask('add', 'edit');

		parent::execute();
	}

	public function displayTask()
	{
		$filters = array();

                $session = \App::get('session');
                $state = \User::getState('folder');
		$directory = '/var/www/hub/app/site/media';
//ddie(Filesystem::directoryTree($directory));
//$model = new Files();
//ddie($model->getDirectoryTree($directory));
		$folders = Filesystem::directoryTree($directory);
		foreach ($folders as $folder) {
			$folder['level'] = $this->getFolderLevel($folder);
		}

		$this->view
			->set('require_ftp', true)
			->set('session', \App::get('session'))
			->set('config', Component::params('com_media'))
			->set('state', $state)
			->set('require_ftp', true)
			->set('folders_id', ' id="media-tree"')
			->set('folder', \User::getState('folder'))
			->set('folders', $folders)
			->display();
	}

	public function editTask()
	{
	}

	public function saveTask()
	{
	}

	public function deleteTask()
	{
	}

	public function getFolderLevel($folder)
	{
		$this->folders_id = null;
		$txt = null;
		if (isset($folder['children']) && count($folder['children']))
		{
			$tmp = $this->folders;
			$this->folders = $folder;
			$txt = $this->loadTemplate('folders');
			$this->folders = $tmp;
		}		
		return $txt;
	}
}
